# MySQL 中的 MVCC 是什么

一句话总结，MVCC是一种实现高并发读写的机制，通过保存数据的多个版本，让读操作不加锁，提升数据库的并发性能。

## MVCC的实现原理

1. 隐藏字段：每行数据包含三个隐藏字段，分别是：
   - `DB_TRX_ID`：最近一次更新该记录的事务ID
   - `DB_ROLL_PTR`：回滚指针，指向该记录的undo log
   - `DB_ROW_ID`：行ID，如果表没有定义主键，InnoDB会自动生成一个隐藏的列作为主键，这个列的值是唯一的

2. Undo Log：Undo Log 是用来记录数据被修改前的值，在回滚时使用，用于实现事务的回滚操作。

3. ReadView：事务在第一次查询时生成，用于判断当前事务的可见性。

## MVCC的工作流程

1. 读操作

​​RR（可重复读）​​：事务内复用同一个 ReadView，保证一致性视图。
​​RC（读已提交）​​：每次查询生成新 ReadView，能看到其他事务已提交的最新数据。

2. 写操作

会将新的数据记录到 Undo Log 中，不会影响其他事务的读操作。